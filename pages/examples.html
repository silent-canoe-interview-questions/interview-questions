<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Examples - Learn Microsoft SQL Server</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">
    <link rel="stylesheet" href="../styles/main.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="../index.html">SQL Tutorial</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="basics.html">Basics</a></li>
                    <li class="nav-item"><a class="nav-link" href="data-manipulation.html">Data Manipulation</a></li>
                    <li class="nav-item"><a class="nav-link" href="advanced-topics.html">Advanced Topics</a></li>
                    <li class="nav-item"><a class="nav-link active" href="examples.html">Examples</a></li>
                    <li class="nav-item"><a class="nav-link" href="best-practices.html">Best Practices</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container mt-5 pt-4">
        <h1 class="mb-4">Interactive SQL Examples</h1>

        <section id="sample-database" class="mb-5">
            <h2>Sample Database: Online Store</h2>
            <p>We'll be using an online store database for our examples. This database includes customers, products, orders, and employees.</p>

            <h3>Database Schema</h3>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Table</th>
                            <th>Description</th>
                            <th>Key Columns</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Customers</td>
                            <td>Customer information</td>
                            <td>CustomerID (PK), Name, Email, Address</td>
                        </tr>
                        <tr>
                            <td>Products</td>
                            <td>Product catalog</td>
                            <td>ProductID (PK), Name, Price, Category</td>
                        </tr>
                        <tr>
                            <td>Orders</td>
                            <td>Order headers</td>
                            <td>OrderID (PK), CustomerID (FK), OrderDate</td>
                        </tr>
                        <tr>
                            <td>OrderDetails</td>
                            <td>Order line items</td>
                            <td>OrderDetailID (PK), OrderID (FK), ProductID (FK)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Database Creation Script</h3>
            <pre><code class="language-sql">-- Create the database
CREATE DATABASE OnlineStore;
GO

USE OnlineStore;
GO

-- Create tables
CREATE TABLE Customers (
    CustomerID INT PRIMARY KEY IDENTITY(1,1),
    Name NVARCHAR(100),
    Email NVARCHAR(100),
    Address NVARCHAR(200)
);

CREATE TABLE Products (
    ProductID INT PRIMARY KEY IDENTITY(1,1),
    Name NVARCHAR(100),
    Price DECIMAL(10,2),
    Category NVARCHAR(50)
);

CREATE TABLE Orders (
    OrderID INT PRIMARY KEY IDENTITY(1,1),
    CustomerID INT FOREIGN KEY REFERENCES Customers(CustomerID),
    OrderDate DATETIME DEFAULT GETDATE(),
    Status NVARCHAR(20)
);

CREATE TABLE OrderDetails (
    OrderDetailID INT PRIMARY KEY IDENTITY(1,1),
    OrderID INT FOREIGN KEY REFERENCES Orders(OrderID),
    ProductID INT FOREIGN KEY REFERENCES Products(ProductID),
    Quantity INT,
    UnitPrice DECIMAL(10,2)
);</code></pre>
        </section>

        <section id="scenario-1" class="mb-5">
            <h2>Scenario 1: Customer Analysis</h2>
            
            <div class="card mb-4">
                <div class="card-body">
                    <h3>Problem: Top Customers Report</h3>
                    <p>Generate a report showing the top 5 customers by total purchase amount, including their contact information and number of orders.</p>

                    <button class="btn btn-primary mb-3" data-bs-toggle="collapse" data-bs-target="#solution1">
                        Show Solution
                    </button>

                    <div class="collapse" id="solution1">
                        <pre><code class="language-sql">SELECT 
    c.CustomerID,
    c.Name,
    c.Email,
    COUNT(DISTINCT o.OrderID) as TotalOrders,
    SUM(od.Quantity * od.UnitPrice) as TotalSpent
FROM Customers c
INNER JOIN Orders o ON c.CustomerID = o.CustomerID
INNER JOIN OrderDetails od ON o.OrderID = od.OrderID
GROUP BY 
    c.CustomerID,
    c.Name,
    c.Email
ORDER BY TotalSpent DESC
FETCH FIRST 5 ROWS ONLY;</code></pre>
                        
                        <h4>Expected Output</h4>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>CustomerID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>TotalOrders</th>
                                        <th>TotalSpent</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>John Smith</td>
                                        <td>john@example.com</td>
                                        <td>15</td>
                                        <td>$2,450.00</td>
                                    </tr>
                                    <!-- Add more sample rows -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="scenario-2" class="mb-5">
            <h2>Scenario 2: Inventory Management</h2>
            
            <div class="card mb-4">
                <div class="card-body">
                    <h3>Problem: Low Stock Alert</h3>
                    <p>Create a stored procedure that identifies products with low stock levels and calculates reorder quantities based on recent sales history.</p>

                    <button class="btn btn-primary mb-3" data-bs-toggle="collapse" data-bs-target="#solution2">
                        Show Solution
                    </button>

                    <div class="collapse" id="solution2">
                        <pre><code class="language-sql">CREATE PROCEDURE CheckLowStock
    @DaysToAnalyze INT = 30,
    @MinStockLevel INT = 10
AS
BEGIN
    WITH RecentSales AS (
        SELECT 
            ProductID,
            SUM(Quantity) as TotalSold,
            SUM(Quantity) / @DaysToAnalyze as DailyAverage
        FROM OrderDetails od
        INNER JOIN Orders o ON od.OrderID = o.OrderID
        WHERE o.OrderDate >= DATEADD(day, -@DaysToAnalyze, GETDATE())
        GROUP BY ProductID
    )
    SELECT 
        p.ProductID,
        p.Name,
        p.CurrentStock,
        rs.TotalSold,
        rs.DailyAverage,
        CEILING(rs.DailyAverage * 14) as SuggestedReorder
    FROM Products p
    LEFT JOIN RecentSales rs ON p.ProductID = rs.ProductID
    WHERE p.CurrentStock <= @MinStockLevel
    ORDER BY p.CurrentStock;
END;</code></pre>

                        <h4>Usage Example</h4>
                        <pre><code class="language-sql">EXEC CheckLowStock @DaysToAnalyze = 30, @MinStockLevel = 10;</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <section id="scenario-3" class="mb-5">
            <h2>Scenario 3: Sales Analytics</h2>
            
            <div class="card mb-4">
                <div class="card-body">
                    <h3>Problem: Monthly Sales Report</h3>
                    <p>Create a report showing monthly sales trends with year-over-year comparison and growth calculation.</p>

                    <button class="btn btn-primary mb-3" data-bs-toggle="collapse" data-bs-target="#solution3">
                        Show Solution
                    </button>

                    <div class="collapse" id="solution3">
                        <pre><code class="language-sql">WITH MonthlySales AS (
    SELECT 
        YEAR(o.OrderDate) as SaleYear,
        MONTH(o.OrderDate) as SaleMonth,
        SUM(od.Quantity * od.UnitPrice) as TotalSales
    FROM Orders o
    INNER JOIN OrderDetails od ON o.OrderID = od.OrderID
    GROUP BY 
        YEAR(o.OrderDate),
        MONTH(o.OrderDate)
)
SELECT 
    curr.SaleYear,
    curr.SaleMonth,
    curr.TotalSales as CurrentSales,
    prev.TotalSales as PreviousYearSales,
    ((curr.TotalSales - prev.TotalSales) / prev.TotalSales) * 100 as GrowthPercentage
FROM MonthlySales curr
LEFT JOIN MonthlySales prev 
    ON curr.SaleMonth = prev.SaleMonth 
    AND curr.SaleYear = prev.SaleYear + 1
ORDER BY 
    curr.SaleYear,
    curr.SaleMonth;</code></pre>

                        <h4>Creating a Visual Report</h4>
                        <pre><code class="language-sql">-- Create a summary table for Power BI or reporting tools
CREATE VIEW SalesTrends AS
SELECT 
    DATEFROMPARTS(SaleYear, SaleMonth, 1) as SaleDate,
    CurrentSales,
    PreviousYearSales,
    GrowthPercentage
FROM (/* Previous query here */) as SalesData;</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <section id="scenario-4" class="mb-5">
            <h2>Scenario 4: Customer Service</h2>
            
            <div class="card mb-4">
                <div class="card-body">
                    <h3>Problem: Order Status Tracking</h3>
                    <p>Create a system to track order status changes and notify customers of updates.</p>

                    <button class="btn btn-primary mb-3" data-bs-toggle="collapse" data-bs-target="#solution4">
                        Show Solution
                    </button>

                    <div class="collapse" id="solution4">
                        <pre><code class="language-sql">-- Create order status history table
CREATE TABLE OrderStatusHistory (
    HistoryID INT PRIMARY KEY IDENTITY(1,1),
    OrderID INT FOREIGN KEY REFERENCES Orders(OrderID),
    Status NVARCHAR(20),
    ChangedDate DATETIME DEFAULT GETDATE(),
    ChangedBy NVARCHAR(50)
);

-- Create trigger for status changes
CREATE TRIGGER trg_OrderStatusChange
ON Orders
AFTER UPDATE
AS
BEGIN
    IF UPDATE(Status)
    BEGIN
        INSERT INTO OrderStatusHistory (
            OrderID,
            Status,
            ChangedBy
        )
        SELECT 
            i.OrderID,
            i.Status,
            SYSTEM_USER
        FROM inserted i;

        -- Here you would typically call a notification procedure
        EXEC NotifyCustomerOfStatusChange @OrderID;
    END
END;</code></pre>

                        <h4>Querying Order History</h4>
                        <pre><code class="language-sql">-- Get complete order history
SELECT 
    o.OrderID,
    c.Name as CustomerName,
    osh.Status,
    osh.ChangedDate,
    osh.ChangedBy
FROM Orders o
INNER JOIN Customers c ON o.CustomerID = c.CustomerID
INNER JOIN OrderStatusHistory osh ON o.OrderID = osh.OrderID
WHERE o.OrderID = @OrderID
ORDER BY osh.ChangedDate DESC;</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <section id="scenario-5" class="mb-5">
            <h2>Scenario 5: Data Cleanup</h2>
            
            <div class="card mb-4">
                <div class="card-body">
                    <h3>Problem: Duplicate Order Detection</h3>
                    <p>Write a script to identify and handle potential duplicate orders in the system.</p>

                    <button class="btn btn-primary mb-3" data-bs-toggle="collapse" data-bs-target="#solution5">
                        Show Solution
                    </button>

                    <div class="collapse" id="solution5">
                        <pre><code class="language-sql">-- Find potential duplicates
WITH DuplicateCheck AS (
    SELECT 
        CustomerID,
        OrderDate,
        COUNT(*) as OrderCount,
        STRING_AGG(OrderID, ',') as OrderIDs
    FROM Orders
    GROUP BY 
        CustomerID,
        OrderDate
    HAVING COUNT(*) > 1
)
SELECT 
    dc.*,
    c.Name as CustomerName,
    od.ProductID,
    od.Quantity,
    od.UnitPrice
FROM DuplicateCheck dc
INNER JOIN Customers c ON dc.CustomerID = c.CustomerID
INNER JOIN Orders o ON o.CustomerID = dc.CustomerID 
    AND o.OrderDate = dc.OrderDate
INNER JOIN OrderDetails od ON o.OrderID = od.OrderID
ORDER BY 
    dc.OrderDate,
    dc.CustomerID;</code></pre>

                        <h4>Handling Duplicates</h4>
                        <pre><code class="language-sql">-- Create a stored procedure to merge duplicates
CREATE PROCEDURE MergeDuplicateOrders
    @SourceOrderID INT,
    @TargetOrderID INT
AS
BEGIN
    BEGIN TRANSACTION;
    
    BEGIN TRY
        -- Move order details to target order
        UPDATE OrderDetails
        SET OrderID = @TargetOrderID
        WHERE OrderID = @SourceOrderID;
        
        -- Delete source order
        DELETE FROM Orders
        WHERE OrderID = @SourceOrderID;
        
        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        THROW;
    END CATCH;
END;</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <div class="navigation-buttons d-flex justify-content-between mt-5">
            <a href="advanced-topics.html" class="btn btn-secondary">&larr; Previous: Advanced Topics</a>
            <a href="best-practices.html" class="btn btn-primary">Next: Best Practices &rarr;</a>
        </div>
    </main>

    <footer class="bg-light mt-5 py-3">
        <div class="container text-center">
            <p>© 2025 SQL Tutorial. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sql.min.js"></script>
    <script src="../scripts/main.js"></script>
</body>
</html>